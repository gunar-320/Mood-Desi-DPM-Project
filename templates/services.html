<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mood-Desi Detector Page</title>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" /> <!-- https://fonts.google.com/ -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet" /> <!-- https://getbootstrap.com/ -->
    <link href="../static/fontawesome/css/all.min.css" rel="stylesheet" /> <!-- https://fontawesome.com/ -->
    <link href="../static/css/templatemo-diagoona.css" rel="stylesheet" />
    <style>
        video {

            z-index: -1;
            top: 0px;
            left: 0;
            /* Mirror the local video */
            transform: scale(-1, 1);            /*For Firefox (& IE) */
            -webkit-transform: scale(-1, 1);     /*for Chrome & Opera (& Safari) */
        }
        canvas {
            top: 200px;
            left: 250px;
            position: absolute;
            z-index:1
        }
    </style>

</head>

<body>
    <div class="tm-container">        
        <div>
            <div class="tm-row pt-4">
                <div class="tm-col-left">
                    <div class="tm-site-header media">
                        <div class="media-body">
                            <h5 class="tm-sitename text-uppercase"><img src="../static/logo.jpg"
                                width="150" 
                                height="150" /> : How you Feeling?</h5>
                        </div>        
                    </div>
                </div>
                <div class="tm-col-right">
                    <nav class="navbar navbar-expand-lg" id="tm-main-nav">
                        <button class="navbar-toggler toggler-example mr-0 ml-auto" type="button" 
                            data-toggle="collapse" data-target="#navbar-nav" 
                            aria-controls="navbar-nav" aria-expanded="false" aria-label="Toggle navigation">
                            <span><i class="fas fa-bars"></i></span>
                        </button>
                        <div class="collapse navbar-collapse tm-nav" id="navbar-nav">
                            <ul class="navbar-nav text-uppercase">
                                <li class="nav-item">
                                    <a class="nav-link tm-nav-link" href="/">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link tm-nav-link" href="/about">About</a>
                                </li>
                                <li class="nav-item active">
                                    <a class="nav-link tm-nav-link" href="/moodDetector">Mood Detector <span class="sr-only">(current)</span></a>
                                </li>                            
                                <li class="nav-item">
                                    <a class="nav-link tm-nav-link" href="/queries">Queries</a>
                                </li>
                            </ul>                            
                        </div>                        
                    </nav>
                </div>
            </div>

    
            <div>
                <div>
                    <div style="padding-top: 5px; padding-left: 350px; align-items: center; margin: auto;">
                        <video id="video" autoplay playsinline muted> </video>
                        <!-- From id == video; video caan be accessed// Jatin -->
                    </div>

                    <span style="width:80%;margin: auto;padding-left:1150px;">
                        <button class="btn btn-primary"> <a href="/analysis" target="_blank">Analysis </a> </button>
                        <button class="btn btn-primary" id="start_scr"> Start Screen Sharing</button>
                        <button class="btn btn-secondary" id="stop"> Stop</button>
                        <button class="btn btn-primary" id="start_cam">Start Camera</button>
                    </span>


                    <script>
                        const videoElem = document.getElementById("video");
                        const startElemcam = document.getElementById("start_cam");
                        const startElemscr = document.getElementById("start_scr");
                        const stopElem = document.getElementById("stop");
                        const plotStart = document.getElementById("plot_start");


                        // Options for getDisplayMedia()
                        var displayMediaOptions = {
                            video: {
                            cursor: "always",
                            height: 800,
                            width: 1000
                            },
                            audio: false
                        };

                        // Set event listeners for the start and stop buttons
                        // Start the Camera capture
                        startElemcam.addEventListener("click", function (evt) {
                            startCamCapture();
                            evt.preventDefault();
                        }, false);

                        // Start the screen capture
                        startElemscr.addEventListener("click", function (evt) {
                            startScrCapture();
                            evt.preventDefault();
                        }, false);

                        // Stop the screen capture
                        stopElem.addEventListener("click", function (evt) {
                            stopCapture();
                        }, false);

                        async function startCamCapture() {
                            try {
                                videoElem.srcObject = await navigator.mediaDevices.getUserMedia(displayMediaOptions);
                                dumpOptionsInfo();
                            } catch (err) {
                                // Handle error
                                console.error("Error: " + err);
                            }
                        }

                        // Start the screen capture
                        async function startScrCapture() {
                            try {
                                videoElem.srcObject = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
                                dumpOptionsInfo();
                            } catch (err) {
                                // Handle error
                                console.error("Error: " + err);
                            }
                        }

                        // Stop the stream
                        function stopCapture(evt) {
                            let tracks = videoElem.srcObject.getTracks();
                            tracks.forEach(track => track.stop());
                            videoElem.srcObject = null;
                        }

                        // Dump the available media track capabilities to the console
                        function dumpOptionsInfo() {
                            const videoTrack = videoElem.srcObject.getVideoTracks()[0];
                            console.info("Track settings:");
                            console.info(JSON.stringify(videoTrack.getSettings(), null, 2));
                            console.info("Track constraints:");
                            console.info(JSON.stringify(videoTrack.getConstraints(), null, 2));
                        }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <script src="../static/js/jquery-3.4.1.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/jquery.backstretch.min.js"></script>
    <script src="../static/js/templatemo-script.js"></script>
    <script id="emoDetect" src="../static/emoDetect.js" data-source="video" data-mirror="true" data-uploadWidth="500"></script>

</body>

</html>